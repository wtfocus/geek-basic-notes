[TOC]

## 21 | 哈希算法（上）：如何防止数据中的用户信息被脱库？

![](http://ww1.sinaimg.cn/large/006tNc79ly1g5jazaoy4wj30vq0hsjsd.jpg)

1.  本节主题
    -   在实际开发中，**我们该如何用哈希算法解决问题**。

### 哈希算法

1.  名称

    - “散列”/“哈希”，英文就是 “Hash”。
    - “哈希算法” 叫 “Hash 算法”/“散列算法”。
2.  定义
    - 将**任意长度的**二进制值串映射为**固定长度**的二进制值串，这个映射规则就是**哈希算法。**
    - 映射后得到的**二进制值串**就是**哈希值**。
3.  针对优秀的哈希算法的几点要求
    1. 从哈希值**不能反向推导**出原始数据
    2. 对**输入数据非常敏感**，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也不大相同。
    3. 散列**冲突的概率要很小**，对于不同的原始数据，哈希值相同的概率非常小。
    4. 哈希算法的**执行效率要尽量高效**，针对较长文本，也能快速地计算出哈希值。

### 应用一：安全加密

1.  前面的四点要求中，对用于加密的哈希算法来说，有两点格外重要：

    -  不能根据哈希**反向推导**出原始数据
    -  散列冲突的**概率**要很小

2.  为什么哈希算法无法做到零冲突？

    - 哈希算法产生的哈希值的长度是**固定且有限**的。

    - 如，哈希值是固定 128 位，最多能表示 2^128 个数据。需要哈希的数据是**无穷**的。如果我们对 `2^128 + 1` 个数据求哈希值，就必然会存在哈希值相同的情况。

    - 哈希值越长，散列冲突的概率越低。


### 应用二：唯一标识

1.  在对比图片时
2.  取图片的二进制串中，前 100 位，中间 100 位，后 100 位。通过哈希算法，得到一个哈希字符串，做图片唯一标识，来判断比较。

2.  把每个图片的唯一标识存在散列表中，在散列表中查这个唯一标识。

### 应用三：数据校验

1.  分片下载文件时，我们如何校验小文件块的呢？
2.  分片后的小文件块分别取哈希值，保存在种子文件中。
3.  当文件下载完成后，通过相同的哈希算法，对下载好的文件块逐一求哈希值，然后跟种子文件中保存的哈希值对比。

### 应用四：散列函数

1.  散列函数也是哈希算法的一种应用。
2.  散列函数对于散列算法的要求
    -   散列值尽量**分布平均**
    -   计算**效率高**

### 解决开篇

1.  开篇题
    -   如何防止数据中的用户信息被脱库？
2.  解决思路

	- 在 MD5 的基础上。引入一个“盐”的思想。
    - 用它来跟用户密码组合，做哈希算法加密，增加密码复杂度。
### 课后思考

- 区块链使用的是哪种哈希算法？是为了解什么问题而使用的呢？

### 精选留言

1.  #Smallfly

    - 区块链是一块块区块组成的，每个区块分为两部分：
        - 区块头
        - 区块体
    - 区块头保存自己区块体和上一个区块头的哈希值。
    - 因为这种链式关系和哈希值的唯一性，只要区块链上任意一个区块被修改过，后面所有区块保存的哈希值就不对了。
    - 区块链使用的是 SHA256 哈希算法，计算哈希值非常耗时，如果要篡改一个区块，就必须重新计算该区块后面所有的区块的哈希值，短时间内几乎不可能做到。

