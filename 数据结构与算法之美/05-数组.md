[toc]

## 05 | 数组：为什么很多编程语言中数组都从 0 开始编号？

1.  定义
    -   数组是一种**线性表**数据结构。它用一组**连续**的内存空间，来存储一组具有**相同类型**的数据。
2.  相关概念
    -   **线性表**：就是数据排成像一条线一样的结构。每个线性表上的数据最多只有前和后的两个方向。
        -   ![img](imgs/b6b71ec46935130dff5c4b62cf273477.jpg)
    -   **非线性表**：数据之间并不是简单的前后关系。
        -   ![img](imgs/6ebf42641b5f98f912d36f6bf86f6569.jpg)
3.  限制：**连续的内存空间、相同类型的数据**：
    -   优点：**随机访问**
    -   缺点：删除、插入时，为保证连续性，就需要做大量的数据搬移

### 随机访问

1.  数组是如何实现根据下标随机访问数组元素的？

    -   以`int[] a = new int[10]`为例。

    -   内存分布

        -   ![img](imgs/98df8e702b14096e7ee4a5141260cdc4.jpg)

    -   寻址公式

        -   ```c
            a[i]_address = base_address + i * data_type_size
            ```

2.  数组和链表的区别
    -   正确的表述：**数组支持随机访问，根据下标随机访问的时间复杂度为 O(1)。**

### “插入”和“删除”

1.  插入
    -   时间复杂度：最好 O(1); 最坏 O(n); 平均 (1+2+…n)/n=O(n);
    -   优化思路：**替换追加**
        -   前提：数组中数据不需要保持有序状态。
        -   ![img](imgs/3f70b4ad9069ec568a2caaddc231b7dc.jpg)
        -   应用场景：快排。

2.  删除
    -   时间复杂度：最好 O(1);最坏 O(n);平均 O(n)。
    -   优化思路：**标记删除**
        -   前提：数组中数据不必保证连续性。
        -   ![img](imgs/b69b8c5dbf6248649ddab7d3e7cfd7e5.jpg)
        -   应用场景：JVM 标记清除垃圾回收算法。

### 容器 vs 数组

1.  数组使用场景
    -	关注**性能**时，选用数组
    -	相关**操作**非常简单，选用数组
    -	多维数据，选用数组
2.  小结
    -   **业务开发**，直接使用容器。
    -   **底层开发**，数组优于容器。

### 解答开篇

1.  问题：**为什么大多数编程语言中，数组要从 0 开始编号，而不是从 1 开始呢？**

    -   第一：内存寻址公式中少一次减法运算。极致效率优化。

        >   下标 0 开始：
        >
        >   a[k]_address = base_address + k * type_size
        >
        >   
        >
        >   下标 1 开始：
        >
        >   a[k]_address = base_address + (k-1)*type_size

    -   第二：历史原因

        >   在一定程度上减少 C 语言程序员学习 Java 的学习成本（C 语言的设计者用 0 开始计数数组下标），因此继续沿用了从 0 开始计数的习惯。

## 课后思考

1. JVM 的标记清除垃圾回收算法的核心理念？
2. 二维数组的内存寻址公式？

### 精选留言

1.  #杰杰 置顶

    >   JVM标记清除算法：
    >
    >   
    >
    >   大多数主流虚拟机采用可达性分析算法来判断对象是否存活，在标记阶段，会遍历所有 GC ROOTS，将所有 GC ROOTS 可达的对象标记为存活。只有当标记工作完成后，清理工作才会开始。
    >
    >   
    >
    >   不足：
    >
    >   1.效率问题。标记和清理效率都不高，但是当知道只有少量垃圾产生时会很高效。
    >
    >   2.空间问题。会产生不连续的内存空间碎片。
    >
    >   
    >
    >   二维数组内存寻址：
    >
    >   
    >
    >   对于 m * n 的数组，`a [ i ][ j ] (i < m,j < n)`的地址为：
    >
    >   `address = base_address + ( i * n + j) * type_size`

2.  #夜下凝月

    >   突然想到了垃圾桶。
    >
    >   生活中，我们扔进屋里垃圾桶的垃圾，
    >
    >   并没有消失，只是被 ''标记'' 成了垃圾，
    >
    >   只有垃圾桶塞满时，才会清理垃圾桶。
    >
    >   再次存放垃圾